---
import Layout from '../layouts/Layout.astro'
import PostCard from '../components/PostCard.astro'
import fs from 'node:fs'
import path from 'node:path'
import matter from 'gray-matter'

interface Post {
  title: string
  description: string
  date: string
  slug: string
}

// Obtener todos los posts
const postsDirectory = path.join(process.cwd(), 'src', 'content', 'posts')
const posts: Post[] = fs.readdirSync(postsDirectory)
  .filter(file => file.endsWith('.md'))
  .map(file => {
    const filePath = path.join(postsDirectory, file)
    const fileContent = fs.readFileSync(filePath, 'utf-8')
    const { data } = matter(fileContent)
    return {
      title: data.title,
      description: data.description,
      date: data.date,
      slug: file.replace('.md', '')
    }
  })
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
---

<Layout>
  <section class="flex flex-col items-center gap-8 px-4">
    <h2 class="mt-4 text-4xl font-semibold text-text">Ãšltimas Publicaciones</h2>
    <div class="w-full flex flex-col items-center gap-6">
      {posts.map(post => (
        <PostCard
          title={post.title}
          description={post.description}
          date={post.date}
          slug={post.slug}
        />
      ))}
    </div>
  </section>
</Layout>
