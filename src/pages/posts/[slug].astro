---
import matter from 'gray-matter'
import { marked } from 'marked'
import Layout from '../../layouts/Layout.astro'
import '../../styles/posts.css'

const BASE_URL = import.meta.env.BACKEND

const { slug } = Astro.params

const fetchPost = async () => {
  try {
    const response = await fetch(BASE_URL + `/api/posts/${slug}`)
    if (!response.ok) {
      console.error('Error fetching post:', response.statusText)
      return null
    }
    const result = await response.json()
    return result
  } catch (error) {
    console.error('Error fetching post:', error)
    return null
  }
}

const raw = await fetchPost()

if (!raw) {
  return Astro.redirect('/404')
}
const { content } = matter(raw.content)
const html = marked(content)
---

<Layout>
  <div class="post-content" set:html={html} />
</Layout>
